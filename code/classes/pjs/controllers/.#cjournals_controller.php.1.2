<?php

class cJournals_Controller extends cBase_Controller {

	function __construct() {
		parent::__construct();
		$this->m_models['mJournal_Model'] = new mJournal_Model();
		//~ $this->RedirectIfNotLogged($pRedirectUri = '/index.php');
		//~ var_dump( $this->m_models['mJournal_Model']->GetJournals());
		
		$lJournalId = (int)$this->GetValueFromRequestWithoutChecks('journal_id');
				
		if($lJournalId){
			$lViewPageObjectsDataArray['journal_list'] = array(
				'ctype' => 'evSimple_Block_Display',
				'name_in_viewobject' => 'journal_page',
				//'controller_data' => $this->m_models['mJournal_Model']->GetJournals(),
			);
			$lViewPageObjectsDataArray['journal_menu'] = array(
				'ctype' => 'evList_Recursive_Display',
				'recursivecolumn'=>'parentid',
				'name_in_viewobject' => 'journal_menu',
				'templadd'=>'type',
				'controller_data' => $this->m_models['menu_model']->GetJournalMenuContentList($lJournalId, getlang()),
			);
			
			$this->m_pageView = new pSingle_Journal_Page_View(array_merge($this->m_commonObjectsDefinitions, $lViewPageObjectsDataArray));
		}else{
			$lViewPageObjectsDataArray['journal_list'] = array(
				'ctype' => 'evList_Display',
				'name_in_viewobject' => 'journal_list',
				'controller_data' => $this->m_models['mJournal_Model']->GetJournals(),
			);
			
			$this->m_pageView = new pJournal_Page_View(array_merge($this->m_commonObjectsDefinitions, $lViewPageObjectsDataArray));
		}
	}
}

?>